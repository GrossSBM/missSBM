---
title: "Introduction to missSBM"
author: "missSBM team"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Requirement

```{r package requirement}
library(igraph)
library(missSBM)
```

## War network

The `war_graphs` dataset comes with the `missSBM` package: 

```{r load data set}
data("war_graphs")
```

This dataset contains a list of two networks where the nodes are countries and an edge in network `beligerent` means that the two countries have been at least once at war between years 1816 to 2007 while an edge in network `alliance` means that the two countries have had a formal alliance between years 1816 to 2012. The network `beligerent` have less nodes since countries which have not been at war are not considered.
These two networs were extracted from **http://www.correlatesofwar.org/** (version 4.0 for war data see *Sarkees, Meredith Reid and Frank Wayman (2010). Resort to War: 1816 - 2007. Washington DC: CQ Press.*, version 4.1 for formal alliance see *Gibler, Douglas M. 2009. International military alliances, 1648-2008. CQ Press.*).

```{r plot,fig.height=10,fig.width=20}
plot(war_graphs$alliance   , main = "Alliance")
plot(war_graphs$beligerent , main = "Beligerent")
```

### Missing data

Some data may be missing for some countries in the sense that data were collected comprehensively for a subset of countries and for the other countries we only observe their edges with the first subset and not within them. More precisely, we can assume that the sampling is node-centered, therefore there is block of missing data on the diagonal of the adjacency matrix.

```{r sampling}
sampledNet_war <- war_graphs$beligerent %>% 
  as_adj(sparse = FALSE) %>% missSBM::sample(sampling = "node", parameters = .6)
plot(sampledNet_war)
```



```{r inferencew}
vBlocks <- 1:6
collection_sbm <- sampledNet_war$adjMatrix %>% 
  missSBM::estimate(vBlocks = vBlocks, sampling = "node", clusterInit = "spectral", cores = 2)
```
```{r plotICL}
plot(collection_sbm$ICL)
```

```{r smoothed}
smooth(collection_sbm, "both", iterates = 4, cores = 2)
plot(collection_sbm$ICL)
```

```{r cluster}
table(collection_sbm$bestModel$fittedSBM$memberships)
```

We compare with clusterings obtained with the fully observed network.
```{r inferencewfull}
collection_sbm_full <- war_graphs$beligerent %>% 
  as_adj(sparse = FALSE) %>% 
  missSBM::estimate(vBlocks = vBlocks, "node", clusterInit = "spectral", cores = 2, trace = TRUE)
smooth(collection_sbm_full, "both", iterates = 4)
plot(collection_sbm_full$ICL)
```

```{r clustercomparison}
table(collection_sbm$bestModel$fittedSBM$memberships,collection_sbm_full$bestModel$fittedSBM$memberships)
```


```{r blockmodelscomparison}
library(blockmodels)
modsym=BM_bernoulli("SBM_sym",as.matrix(get.adjacency(war_graphs$beligerent)),verbosity=0,plotting="")
modsym$estimate()
plot(modsym$ICL)
mod=BM_bernoulli("SBM",as.matrix(get.adjacency(war_graphs$beligerent)),verbosity=0,plotting="")
mod$estimate()
plot(mod$ICL)
```





